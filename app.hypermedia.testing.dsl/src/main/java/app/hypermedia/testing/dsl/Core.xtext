grammar app.hypermedia.testing.dsl.Core with org.eclipse.xtext.common.Terminals

generate core "http://testing.hypermedia.app/dsl/core"

Model:
    (steps+=TopLevelStep)*;

TopLevelStep:
	ClassBlock |
	RelaxedLinkBlock;

ResponseStep:
    StatusStatement |
    HeaderStatement |
    RepresentationStep |
    FollowStatement
;

RepresentationStep:
    PropertyBlock |
    PropertyStatement |
    LinkStep
;

LinkStep:
    LinkStatement |
    RelaxedLinkBlock |
    StrictLinkBlock
;

Identifier: value=STRING;
Modifier: WithModifier | ExpectModifier;

ExpectModifier: 'Expect';
WithModifier: 'With';

ClassBlock:
	WithModifier 'Class' name=Identifier '{'
		(children+=RepresentationStep)*
	'}';

PropertyBlock:
    modifier=Modifier 'Property' name=Identifier '{'
        (children+=RepresentationStep)*
    '}'
;

PropertyStatement:
    ExpectModifier 'Property' name=Identifier (value=STRING)?
;

StatusStatement:
    ExpectModifier 'Status' status=INT
;

RelaxedLinkBlock:
    WithModifier 'Link' relation=Identifier '{'
        (children+=ResponseStep)*
    '}'
;

StrictLinkBlock:
    ExpectModifier 'Link' relation=Identifier '{'
        (children+=ResponseStep)*
    '}'
;

LinkStatement:
    ExpectModifier 'Link' relation=Identifier
;

HeaderStatement:
    ExpectModifier 'Header' fieldName=FIELD_NAME (exactValue=STRING | regex=MatchingRegex | variable=VARIABLE)?
;

MatchingRegex:
    'Matching' pattern=STRING
;

FollowStatement:
    'Follow' variable=VARIABLE
;

terminal VARIABLE: '[' ( ALPHA )* ']';
terminal FIELD_NAME: ALPHA ('-' | ALPHA)*;

terminal ALPHA: ('a'..'z' | 'A'..'Z');
